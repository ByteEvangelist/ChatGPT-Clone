!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){addEventListener("fetch",e=>{e.respondWith(async function(e,t){new URL(e.url);if("GET"===e.method){let e;try{e=await fetch("https://test.blueridgegrizzly.com/info",{headers:{"Content-Type":"application/json"}});let t=await e.json();e=t.error?new Response(`<ul><li>hf inference not responding ❌ (error: ${t.error.code})</li></ul>`,{headers:{"Content-Type":"text/html;charset=UTF-8"}}):new Response("<ul><li>hf inference responding✅</li></ul>",{headers:{"Content-Type":"text/html;charset=UTF-8"}})}catch(t){console.error("Fetch error: ",t),e=new Response(`<ul><li>fetch error ❌ (fetch error: ${t})</li></ul>`,{headers:{"Content-Type":"text/html;charset=UTF-8"}})}return e}if("POST"===e.method){let t;for(;;)try{const n=await e.json();console.log(JSON.stringify(n)),t=await fetch("https://test.blueridgegrizzly.com/generate_stream",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({inputs:n.map(e=>"user"==e.role?"User:"+e.content+"\n":"system"==e.role?e.content+"\n":"Assistant:"+e.content+"\n").join("")+"Assistant:",parameters:{best_of:1,details:!0,do_sample:!0,max_new_tokens:1e3,repetition_penalty:1.03,return_full_text:!1,seed:null,temperature:.5,top_k:10,top_p:.95,truncate:null,typical_p:.95,watermark:!1}}),timeout:6e4});break}catch(e){console.log("Error name:",e.name),console.log("Error message:",e.message),console.log("Error stack:",e.stack),await new Promise(e=>setTimeout(e,1e3))}const{readable:n,writable:r}=new TransformStream,o=new TextEncoder,s=new TextDecoder,l=r.getWriter(),a=t.body.getReader();let i="";a.read().then((function e({done:t,value:n}){if(t)return l.close(),Promise.resolve();i+=s.decode(n,{stream:!0});let r=i.indexOf("\n");for(;-1!==r;){const e=i;if(e.length>1)try{if(null!=JSON.parse(e.slice(5)).details)return console.log("done"),l.write(o.encode("data: [DONE]")),l.close(),Promise.resolve();console.log("fullchunk:"+e.length+" "+JSON.parse(e.slice(5)).token.text),l.write(o.encode(JSON.stringify({data:JSON.parse(e.slice(5)).token.text})+"\n\n"))}catch(e){console.log(e.message)}i=i.slice(r+1),r=i.indexOf("\n")}return a.read().then(e)}));return new Response(n,{headers:{"Cache-Control":"no-cache","Content-Type":"text/event-stream",Connection:"keep-alive","Access-Control-Allow-Origin":"*"}})}if("OPTIONS"===e.method){let t={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,HEAD,POST,OPTIONS","Access-Control-Allow-Headers":e.headers.get("Access-Control-Request-Headers"),"Access-Control-Max-Age":"86400"};return new Response(null,{headers:t})}}(e.request))})}]);